---
# Source: testlib/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: test-testlib
  labels:
    helm.sh/chart: testlib
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: testlib
    app.kubernetes.io/instance: test
    app.kubernetes.io/component: main
    label: main
    label2: main2
  annotations:
    name: main
    name2: main
spec:
  replicas: 1
  revisionHistoryLimit: 3
  strategy:
    type: RollingUpdate
  selector:
    matchLabels:
      app.kubernetes.io/name: testlib
      app.kubernetes.io/instance: test
      app.kubernetes.io/component: main
  template:
    metadata:
      labels:
        app.kubernetes.io/name: testlib
        app.kubernetes.io/instance: test
        app.kubernetes.io/component: main
        label: main3
        label2: main4
      annotations:
        podName: main
        podName2: main
    spec:
      imagePullSecrets:
        - name: test
      serviceAccountName: default
      securityContext:
        runAsNonRoot: true
        runAsUser: 36
      affinity:
        {}
      containers:
        - name: "main"
          securityContext:
            runAsNonRoot: true
            runAsUser: 36
          image: "camptocamp/main:latest"
          imagePullPolicy: IfNotPresent
          terminationMessagePolicy: FallbackToLogsOnError
          resources:
            limits:
              cpu: 2
              memory: 2Gi
            requests:
              cpu: 20m
              memory: 200Mi
---
# Source: testlib/templates/sub-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: test-testlib-sub
  labels:
    helm.sh/chart: testlib
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: testlib
    app.kubernetes.io/instance: test
    app.kubernetes.io/component: sub
spec:
  replicas: 1
  revisionHistoryLimit: 3
  strategy:
    type: RollingUpdate
  selector:
    matchLabels:
      app.kubernetes.io/name: testlib
      app.kubernetes.io/instance: test
      app.kubernetes.io/component: sub
  template:
    metadata:
      labels:
        app.kubernetes.io/name: testlib
        app.kubernetes.io/instance: test
        app.kubernetes.io/component: sub
    spec:
      imagePullSecrets:
        - name: test
      serviceAccountName: default
      securityContext:
        runAsNonRoot: true
        runAsUser: 36
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app.kubernetes.io/component
                operator: In
                values:
                - sub
              - key: app.kubernetes.io/instance
                operator: In
                values:
                - test
              - key: app.kubernetes.io/name
                operator: In
                values:
                - testlib
            topologyKey: "kubernetes.io/hostname"
      containers:
        - name: "main"
          securityContext:
            runAsNonRoot: true
            runAsUser: 36
          image: "camptocamp/sub@sha256:1234"
          imagePullPolicy: IfNotPresent
          env:
            - name: "configMap"
              valueFrom:
                configMapKeyRef:
                  name: "cm"
                  key: "data"
            - name: "configMapOverride"
              valueFrom:
                configMapKeyRef:
                  name: "overwritten"
                  key: "data"
            - name: "direct"
              value: "test"
            - name: "directValue"
              value: "test"
            - name: "none"
              value: "None"
            - name: "secret"
              valueFrom:
                secretKeyRef:
                  name: "s"
                  key: "data"
            - name: "zz_first"
              value: "zz"
            - name: "aa_last"
              value: "aa$(zz_first)aa"
          terminationMessagePolicy: FallbackToLogsOnError
          resources:
            limits:
              cpu: 1
              memory: 1Gi
            requests:
              cpu: 10m
              memory: 100Mi
